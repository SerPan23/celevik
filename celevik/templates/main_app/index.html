{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% block links %}
    <link rel="stylesheet" href="{% static 'css/slimselect.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/main_app/index.css' %}">
{% endblock links %}
{% block content %}
    <div class="search-box">
        <div class="container sort-box">
            <form class="sort-form" method="POST" enctype="multipart/form-data" action="/">
                {% csrf_token %}
                <h2 class="text-center mb-3">Фильтры</h2>
                <div class="mb-4">
                    <select id="universities-multiple" class="formInput multi-select-custom" multiple>
                        {% for university in universities %}
                            <option value="{{ university.title }}">{{ university.title }}</option>
                        {% endfor %}
                    </select>
                    <input type="hidden" id="universities" name="universities" value="">
                </div>
                <div class="mb-4">
                    <select id="directions-multiple" class="formInput multi-select-custom" multiple>
                        {% for direction in directions %}
                            <option value="{{ direction.code }}">Специальность {{ direction.code }} — «{{ direction.title }}»</option>
                        {% endfor %}
                    </select>
                    <input type="hidden" id="directions" name="directions" value="">
                </div>
                <div>
                    <button class="btn-styled link-btn mb-5">Применить</button>
                </div>
            </form>
        </div>
    </div>
    <div class="container">
        <h2 class="text-center mb-3">Вакансии</h2>
        <div class="row">
            {% for vacancy in vacancies %}
                <div class="col-12 col-md-6 col-lg-4 col-xxl-3 mb-5">
                    <div class="vacancy-card">
                        <h5 class="name">{{ vacancy.title }}</h5>
                        <p class="description">{{ vacancy.description|truncatechars:120 }}</p>
                        <p class="partners">
                            <span>Вузы партнеры: </span>
                            {% with vacancy.partners|split:"|" as partners %}
                                {% for p in partners %}
                                    <span class="partner">{{ p }}</span>{% if not forloop.last %},{% endif %}
                                {% endfor %}
                            {% endwith %}
                        </p>
                        <a href="/vacancy/{{ vacancy.id }}" class="more-detailed">Подробнее</a>
                    </div>
                </div>
            {% empty %}
                <h3 class="text-center">С заданными фильтрами результаты не найдены!</h3>
            {% endfor %}
        </div>
    </div>
{% endblock content %}

{% block scripts %}
    <script src="{% static 'js/slimselect.min.js' %}"></script>

    <script>
        var select = new SlimSelect({
            select: '#universities-multiple',
            closeOnSelect: false,
            searchText: 'Нет результатов',
            placeholder: 'Выберите вузы',
            hideSelectedOption: true,
            onChange: (info) => {
                {#console.log(select.selected().join('|'))#}
                document.getElementById("universities").value = select.selected().join('|');
            }
        })
        var select2 = new SlimSelect({
            select: '#directions-multiple',
            closeOnSelect: false,
            searchText: 'Нет результатов',
            placeholder: 'Выберите направления',
            hideSelectedOption: true,
            onChange: (info) => {
                {#console.log(select.selected().join('|'))#}
                document.getElementById("directions").value = select2.selected().join('|');
            }
        })
        let d = "{{ sort_universities }}".split('|')
        let d2 = "{{ sort_directions }}".split('|')
        select.set(d)
        select2.set(d2)
    </script>
{% endblock scripts %}